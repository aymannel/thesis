\section{Manipulating Circuits}%
\label{manipulating-circuits}

The \lstinline{GadgetCircuit} class offers the ability to manipulate circuits containing Pauli gadgets via the \lstinline{apply()} method. This method takes a quantum gate object as its input and inserts it, along with its adjoint, into the circuit. The \lstinline{start} and \lstinline{end} parameters allow us to specify the insertion positions.

\includejupyter{chapter-6/apply1}{chapter-6/apply1_zx}{0.4}

If no insertion positions are specified, the specified quantum gate and its adjoint are inserted at the start and at the end of the circuit respectively. The relevant commutation relations developed in Section \ref{clifford-commutation-relations} are then applied as required.

\includejupyter{chapter-6/apply2}{chapter-6/apply2_zx}{0.4}

The \lstinline{apply()} method is not limited to CNOT gates -- we could have instead chosen any of the quantum gates mentioned in the previous section. The commutation logic uses Stim's \lstinline{Tableau} class to construct the required Clifford tableau ensuring that the correct transformation is applied. Below we conjugate with the CZ gate.

\includejupyter{chapter-6/apply_cz}{chapter-6/apply_cz_zx}{0.4}

The \lstinline{GadgetCircuit} class offers the ability to manipulate circuits containing multiple gadgets simultaneously. Below, we instantiate the minimal one-body excitation operator discussed in Figure \ref{minimal-one-body}.

\includejupyter{chapter-6/single1}{chapter-6/single1_zx}{0.45}

It is then a simple matter of conjugating with CNOT gates to faithfully replicate the derivation revealing a singly-controlled $Y$ rotation as shown in Section \ref{operator-controlled-rotations}.

\includejupyter{chapter-6/single2}{chapter-6/single2_zx}{0.58}

We can replicate the derivation revealing a singly-controlled $Y$ rotation from a one-body excitation operator acting on qubits $p=0$ and $q=4$. We begin by instantiating the one-body excitation operator as follows.

\includejupyter{chapter-6/single3a}{chapter-6/single3a_zx}{0.45}

Then, with the following lines of code, we eliminate the $Z$ legs responsible for calculating the parity of the fermionic state, then, by expressing the single-legged Pauli gadget as a single-qubit rotation in the Y basis and fusing it with the adjacent Pauli gadget, we obtain the following controlled Y rotation.

\includejupyter{chapter-6/single3b}{chapter-6/single3b_zx}{0.8}
