\section{Manipulating Circuits}%
\label{manipulating-circuits}

The \lstinline{GadgetCircuit} class offers the ability to manipulate circuits containing Pauli gadgets via the \lstinline{apply()} method. This method takes a quantum gate object as its input and inserts it, along with its adjoint, into the circuit. The \lstinline{start} and \lstinline{end} parameters allow us to specify the insertion positions.

\includejupyter{chapter-6/apply1}{chapter-6/apply1_zx}{0.4}

If no insertion positions are specified, the specified quantum gate and its adjoint are inserted at the start and at the end of the circuit respectively. The relevant commutation relations developed in Section \ref{clifford-commutation-relations} are then applied as required.

\includejupyter{chapter-6/apply2}{chapter-6/apply2_zx}{0.4}

The \lstinline{apply()} method is not limited to CNOT gates -- we could have instead chosen any of the quantum gates mentioned in the previous section. The commutation logic uses Stim's \lstinline{Tableau} class to construct the required Clifford tableau ensuring that the correct transformation is applied. Below we conjugate with the CZ gate.

\includejupyter{chapter-6/apply_cz}{chapter-6/apply_cz_zx}{0.4}

The \lstinline{GadgetCircuit} class offers the ability to manipulate circuits containing multiple gadgets simultaneously. Below, we instantiate the minimal one-body excitation operator discussed in Figure \ref{minimal-one-body}.

\includejupyter{chapter-6/single1}{chapter-6/single1_zx}{0.45}

It is then simply a matter of conjugating with CNOT gates to replicate the derivation revealing a singly-controlled $Y$ rotation, as shown in Section \ref{operator-controlled-rotations}.

\includejupyter{chapter-6/single2}{chapter-6/single2_zx}{0.58}

We can replicate the derivation that reveals a singly-controlled $Y$ rotation from a one-body excitation operator shown in Section \ref{operator-controlled-rotations}. We begin by instantiating the \lstinline{GadgetCircuit()} object with the following lines of code.

\includejupyter{chapter-6/single3a}{chapter-6/single3a_zx}{0.47}

Then, using the following lines of code, we eliminate the $Z$ legs responsible for calculating the parity of the fermionic state, and reveal the two Pauli gadgets, that together, correspond to a singly-controlled $Y$ rotation.

\includejupyter{chapter-6/single3b}{chapter-6/single3b_zx}{0.84}

Similarly, we can replicate the derivation in Kornell \textit{et al} \cite{Kornell2023}. We begin by instantiating the \lstinline{GadgetCircuit()} object as follows.

\includezxdiagram{chapter-6/double1}{1}
\includezxdiagram{chapter-6/double1_zx}{0.9}

Then, using the following lines of code, we reveal a triply-controlled $Y$ rotation.

\includezxdiagram{chapter-6/double2}{1}
\includezxdiagram{chapter-6/double2_zx}{1}

